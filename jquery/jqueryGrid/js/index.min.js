!function(a,n){var t={header:[],order:{},ajaxConfig:{}},i={_sort:function(a){var n=a.data,t=a.name,i="asc"===a.type?1:-1;return"number"==typeof n[0][t]?n.sort(function(a,n){return i*(a[t]-n[t])}):n.sort(function(a,n){return i*a[t].localeCompare(n[t])})},_formatNumber:function(a){var n=String(a),t=n.length;return n.replace(/\d{3}/g,function(a,n){return a+(t-n>3?",":"")})}},e={_init:function(){return this._render()._handle()},_render:function(){var n="",t=this.order.type||"",i=this.order.name||"";a.each(this.header,function(a,e){var o=e.name||"",r=e.isOrder||!1,s=e.width,d="",l=!1,g=!1;r&&(i===o&&("asc"===t?l=!0:"desc"===t&&(g=!0)),d='<i class="_asc'+(l?" _active":"")+'"></i><i class="_desc'+(g?" _active":"")+'"></i>'),n+='<div class="_col" name="'+o+'" is_order="'+r+'" col_index="'+a+'" style="'+(s?"width="(s+"px"):"")+'"><div class="_header"><h6>'+(e.text||"")+"</h6>"+d+"</div><ul></ul></div>",g=null,l=null,d=null,r=null,o=null});var e='<div class="_data" order_type="'+t+'" order_name="'+i+'"z>'+n+'</div><div class="_toolbar"><div class="_tool"><div class="_dir _left"><div class="_prev"><i></i></div><div class="_backward"><i></i><i></i></div></div><div class="_page">Page <input type="text" class="_content"> of <span class="_totalPage"></span></div><div class="_dir _right"><div class="_next"><i></i></div><div class="_forward"><i></i><i></i></div></div></div><div class="_view"> View <span class="_count"></span> of <span class="_totalCount"></span></div></div><div class="_loading"><span class="_left"></span><span class="_right"></span></div>';return this.$data=this.addClass("_grid").html(e).find(">._data"),this.$toolbar=this.find(">._toolbar"),this.$loading=this.find(">._loading"),this.dragging=!1,e=null,isOpen=null,t=null,i=null,n=null,this._ajax(this.ajaxConfig)},_appendRow:function(){var n=this;a.each(n.header,function(t,i){var e=i.name||"",o="";a.each(n.pagination.data,function(a,n){o+="<li class='"+(n.active?"_active":"")+"' row_index='"+a+"'>"+(n[e]||"")+"</li>"}),n.$data.find(">._col[name="+e+"] >ul").html(o),o=null,e=null})},_handle:function(){var n=this,t=this.$data,e=t.find(">._col >ul"),o=t.find(">._col >._header");return e.on("mouseover",">li",function(t){n.dragging||e.find(">li[row_index="+a(this).index()+"]").addClass("_hover")}).on("mouseout",">li",function(t){n.dragging||e.find(">li[row_index="+a(this).index()+"]").removeClass("_hover")}).on("click",">li",function(t){if(!n.dragging){var i=a(this).index();n.pagination.data[i].active=e.find(">li[row_index="+i+"]").toggleClass("_active").hasClass("_active")}}),o.on("contextmenu",function(a){a.preventDefault()}).on("mousedown",function(t){if(2===t.buttons){var i=a(this).parent().addClass("_drag");n.dragging=!0,n.darggingTargetCol=i[0],i.css({left:t.clientX- -10+"px",top:t.clientY- -10+"px"}),n.$toolbar.find(">._tool").css("marginLeft",-i.width()/2+"px"),a(document).on("mousemove",function(a){i.css({left:a.clientX- -10+"px",top:a.clientY- -10+"px"})}).on("mouseup",function(t){if(n.draggingInTragetCol){var e=n.draggingInTragetCol.find(">._header");e.hasClass("_dragInLeft")?n.draggingInTragetCol.before(n.darggingTargetCol):e.hasClass("_dragInRight")&&n.draggingInTragetCol.after(n.darggingTargetCol)}n.dragging=!1,n.darggingTargetCol=null,n.draggingInTragetCol=null,n.$toolbar.find(">._tool").css("marginLeft",0),a(document).off("mousemove mouseup"),i.removeClass("_drag"),o.removeClass("_dragInLeft _dragInRight")})}}).on("mouseenter",function(t){var i=a(this);n.draggingInTragetCol=i.parent(),n.dragging&&n.draggingInTragetCol[0]!==n.darggingTargetCol&&i.off("mousemove").on("mousemove",function(a){var n="_dragInLeft";a.offsetX>i.parent().width()/2&&(n="_dragInRight"),o.removeClass("_dragInLeft _dragInRight"),i.addClass(n)})}).find("h6").on("click",function(e){var o=a(this),r=o.parent().parent(),s=r.attr("name"),d=t.attr("order_type");if(!(r.attr("is_order")&&d&&s))return o;var l="asc"===d?"desc":"asc";t.attr({order_name:s,order_type:l}).find(">._col >._header >i._active").removeClass("_active"),o.nextAll("i._"+l).addClass("_active").siblings("i").removeClass("_active"),i._sort({data:n.pagination.data,name:s,type:d}),n._appendRow()}),n.$toolbar.find(">._tool >._dir._left >._prev").on("click",function(t){var i=a(this).parent();n.pagination.page<=1||(n.pagination.page--,1===n.pagination.page?i.removeClass("_active"):i.nextAll("._dir._right").addClass("_active"),n.ajaxConfig.page=n.pagination.page,n._ajax(n.ajaxConfig))}).parent().nextAll("._dir._right").find("._next").on("click",function(t){var i=a(this).parent(),e=n.pagination.totalPage;n.pagination.page>=e||(n.pagination.page++,n.pagination.page===e?i.removeClass("_active"):i.prevAll("._dir._left").addClass("_active"),n.ajaxConfig.page=n.pagination.page,n._ajax(n.ajaxConfig))}),this},_ajax:function(n){var t=this;return a.ajax({type:"GET",url:n.url,data:n.data,dataType:n.dataType||"json",beforeSend:function(a){t.$loading.fadeIn().show().find(">span._left").css("left",0).next().css("right",0)},success:function(a,n,e){var o=a.page,r=(o-1)*a.pageCount,s=a.data;1===o&&a.totalPage>o&&t.$toolbar.find(">._tool >._dir._right").addClass("_active"),t.$toolbar.find(">._tool >._page >input._content").val(o).next().text(i._formatNumber(a.totalPage)).parent().parent().next().find(">span._count").text((1===o?1:r)+" - "+(r+s.length)).next().text(i._formatNumber(a.totalCount)),t.pagination=a,t._appendRow()},error:function(a,n,t){console.log(n),console.log(t)},complete:function(a,n){setTimeout(function(){t.$loading.find(">span._left").animate({left:"-50%"},1100).next().animate({right:"-50%"},1e3,function(){t.$loading.fadeOut().hide()})},0)}}),this}};if(a.fn.hasOwnProperty(n))throw new Error("插件 "+n+" 已存在");a.fn[n]=function(n){return a.extend(this,t,n||{},e)._init()}}(window.jQuery,"jqueryGrid");