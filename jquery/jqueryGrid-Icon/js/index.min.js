!function(a,i){var t={header:[],toolbar:{},order:{},ajaxConfig:{}},n={_sort:function(a){var i=a.data,t=a.name,n="asc"===a.type?1:-1;return"number"==typeof i[0][t]?i.sort(function(a,i){return n*(a[t]-i[t])}):i.sort(function(a,i){return n*a[t].localeCompare(i[t])})},_formatNumber:function(a){var i=String(a),t=i.length;return i.replace(/\d{3}/g,function(a,i){return a+(t-i>3?",":"")})}},e={_init:function(){return this._render()._handle()},_render:function(){var i="",t=this.order.type||"",n=this.order.name||"",e=this.height&&this.height.header?this.height.header:"";a.each(this.header,function(a,e){var r=e.name||"",o=e.isOrder||!1,s=e.width,d="",l=!1,g=!1;o&&(n===r&&("asc"===t?l=!0:"desc"===t&&(g=!0)),d='<i class="asc'+(l?" active":"")+'"></i><i class="desc'+(g?" active":"")+'"></i>'),i+='<div class="col" name="'+r+'" is_order="'+o+'" col_index="'+a+'" style="'+(s?"width="(s+"px"):"")+'"><div class="header"><h6>'+(e.text||"")+"</h6>"+d+"</div><ul></ul></div>",g=null,l=null,d=null,o=null,r=null});var r='<div class="data" order_type="'+t+'" order_name="'+n+'"z>'+i+'</div><div class="toolbar"><div class="tool"><div class="dir left"><div class="prev"><i></i></div><div class="backward"><i></i><i></i></div></div><div class="page">Page <input type="text" class="content"> of <span class="totalPage"></span></div><div class="dir right"><div class="next"><i></i></div><div class="forward"><i></i><i></i></div></div></div><div class="view"> View <span class="count"></span> of <span class="totalCount"></span></div></div><div class="loading"><span class="left"></span><span class="right"></span></div>';return this.$data=this.addClass("grid").html(r).find(">div.data"),this.$toolbar=this.find(">div.toolbar"),this.$loading=this.find(">div.loading"),e&&this.$data.find(">div.col >div.header").css({height:e+"px","line-height":e+"px"}),r=null,isOpen=null,t=null,n=null,i=null,this._ajax(this.ajaxConfig)},_appendRow:function(){var i=this,t=this.height&&this.height.dataItem?this.height.dataItem:"";a.each(i.header,function(t,n){var e=n.name||"",r="";a.each(i.pagination.data,function(a,i){r+="<li class='"+(i.active?"active":"")+"' row_index='"+a+"'>"+(i[e]||"")+"</li>"});i.$data.find(">div.col[name="+e+"] > ul").html(r);r=null,e=null}),t&&this.$data.find(">div.col >ul >li").css({height:t+"px","line-height":t+"px"})},_handle:function(){var i=this,t=i.$data,e=t.find(">div.col > ul"),r=t.find(">div.col > div.header");return e.on("mouseover",">li",function(t){!i.dragging&&e.find(">li[row_index="+a(this).index()+"]").addClass("hover")}).on("mouseout",">li",function(i){e.find(">li[row_index="+a(this).index()+"]").removeClass("hover")}).on("click",">li",function(t){var n=a(this).index();i.pagination.data[n].active=e.find(">li[row_index="+n+"]").toggleClass("active").hasClass("active")}),r.on("mouseenter",function(t){var n=a(t.currentTarget);i.draggingInTragetCol=n.parent(),i.dragging&&i.draggingInTragetCol[0]!==i.darggingTargetCol&&n.off("mousemove").on("mousemove",function(a){var i="drag-in-left";a.offsetX>n.parent().width()/2&&(i="drag-in-right"),r.removeClass("drag-in-left drag-in-right"),n.addClass(i)})}).find(">h6").on("mousedown",function(t){if(2!==t.buttons){var n=a(t.currentTarget.parentNode.parentNode).addClass("drag");i.dragging=!0,i.darggingTargetCol=n[0],r.addClass("cursor"),n.css({left:t.clientX- -10+"px",top:t.clientY- -10+"px"}),i.$toolbar.find(">div.tool").css("marginLeft",-n.width()/2+"px"),a(document).on("mousemove",function(a){n.css({left:a.clientX- -10+"px",top:a.clientY- -10+"px"})}).on("mouseup",function(t){if(i.draggingInTragetCol){var e=i.draggingInTragetCol.find(">div.header");e.hasClass("drag-in-left")?i.draggingInTragetCol.before(i.darggingTargetCol):e.hasClass("drag-in-right")&&i.draggingInTragetCol.after(i.darggingTargetCol)}i.dragging=!1,i.darggingTargetCol=null,i.draggingInTragetCol=null,i.$toolbar.find(">div.tool").css("marginLeft",0),a(document).off("mousemove mouseup"),n.removeClass("drag"),r.removeClass("cursor drag-in-left drag-in-right").off("mousemove")})}}).next("i").on("click",function(e){var r=a(this),o=r.parent().parent(),s=o.attr("name"),d=t.attr("order_type");if(!(o.attr("is_order")&&d&&s))return r;r.siblings("i").hasClass("active")?r.addClass("active").siblings("i").removeClass("active"):r.hasClass("active")?r.removeClass("active").siblings("i").addClass("active"):(t.find(">div.col >div.header >i").removeClass("active"),r.addClass("active")),t.attr("order_type","asc"===d?"desc":"asc"),t.attr("order_name",s),n._sort({data:i.pagination.data,type:d,name:s}),i._appendRow()}),i.$toolbar.find(">._tool >._dir._left >._prev").on("click",function(t){var n=a(this).parent();i.pagination.page<=1||(i.pagination.page--,1===i.pagination.page?n.removeClass("_active"):n.nextAll("._dir._right").addClass("_active"),i.ajaxConfig.page=i.pagination.page,i._ajax(i.ajaxConfig))}).parent().nextAll("._dir._right").find("._next").on("click",function(t){var n=a(this).parent(),e=i.pagination.totalPage;i.pagination.page>=e||(i.pagination.page++,i.pagination.page===e?n.removeClass("_active"):n.prevAll("._dir._left").addClass("_active"),i.ajaxConfig.page=i.pagination.page,i._ajax(i.ajaxConfig))}),this},_ajax:function(i){var t=this;return a.ajax({type:"GET",url:i.url,data:i.data,dataType:"json",beforeSend:function(a){t.$loading.fadeIn().show().find(">span.left").css("left",0).next().css("right",0)},success:function(a,i,e){var r=a.page,o=(r-1)*a.pageCount,s=a.data;1===r&&a.totalPage>r&&t.$toolbar.find(">div.tool >div.dir.right").addClass("active"),t.$toolbar.find(">div.tool >div.page >input.content").val(r).next().text(n._formatNumber(a.totalPage)).parent().parent().next().find(">span.count").text((1===r?1:o)+" - "+(o+s.length)).next().text(n._formatNumber(a.totalCount)),t.pagination=a,t._appendRow()},error:function(a,i,t){alert(i),alert(t)},complete:function(a,i){setTimeout(function(){t.$loading.find(">span.left").animate({left:"-50%"},1100).next().animate({right:"-50%"},1e3,function(){t.$loading.fadeOut().hide()})},0)}}),this}};if(a.fn.hasOwnProperty(i))throw new Error("插件 "+i+" 已存在");a.fn[i]=function(i){if(!this.is("div"))throw new Array("必须使用div元素调用");if(this.hasClass("grid"))throw new Array("类名grid插件内部已使用");if(this.length>1)throw new Array("调用的div元素必须是唯一的");return i=i||{},a.extend(this,t,i,e)._init()}}(window.jQuery,"jqueryGrid");